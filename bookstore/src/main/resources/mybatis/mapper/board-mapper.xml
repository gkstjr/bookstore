<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">
	
	<select id="list" parameterType="Map" resultType="BoardDto">
		select * from (
			select rownum rn, TMP.* from (
				select * from board 
				<if test="type != null and keyword != null">
					<![CDATA[ where instr(${type}, #{keyword}) > 0 	]]>
				</if>
				connect by prior board_no = super_no
				start with super_no = 0
				order siblings by group_no desc, board_no asc
			)TMP
		) where rn between #{begin} and #{end}
	</select>
	
	<select id="count" parameterType="Map" resultType="int">
		select count(*) from board
		<if test="type != null and keyword != null">
			<![CDATA[
			where instr(${type}, #{keyword}) > 0
			]]>
		</if>
	</select>
	
	<update id="plusReadcount" parameterType="int">
		update board 
		set board_readcount = board_readcount + 1
		where board_no = #{boardNo}
	</update>
	
	<select id="one" parameterType="int" resultType="BoardDto">
		select * from board where board_no = #{boardNo}
	</select>
	
	<delete id="delete" parameterType="int">
		delete board where board_no = #{boardNo}
	</delete>
	
	<update id="edit" parameterType="BoardDto">
		update board
			set 
				board_head = #{boardHead},
				board_title = #{boardTitle},
				board_content = #{boardContent}
			where
				board_no = #{boardNo}
	</update>
	
	<select id="sequence" resultType="int">
		select board_seq.nextval from dual
	</select>
	
	<insert id="write" parameterType="BoardDto">
		insert into board(
			board_no, board_head, board_title, board_content, board_writer, 
			group_no, super_no, depth
		)
		values(
			#{boardNo}, #{boardHead}, #{boardTitle}, #{boardContent}, #{boardWriter},
			#{groupNo}, #{superNo}, #{depth}		
		)
	</insert>
	
</mapper> 








